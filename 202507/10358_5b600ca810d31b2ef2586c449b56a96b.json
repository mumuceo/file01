[
  {
    "bookSourceComment": "支持番茄小说，QQ免费小说，熊猫小说，得间小说，七猫小说，起点69小说\n\n更新说明：\n登录页新增手动切换书籍来源选项按钮\n20241126修复bug\n20241129更新秘钥填写方式\n20241217更新服务器切换功能\n20250104新增服务器\n20250105登录新增手动填写服务器",
    "bookSourceGroup": "番茄小说,书山",
    "bookSourceName": "📚书山小说",
    "bookSourceType": 0,
    "bookSourceUrl": "https://api.shusan.cc\n提示：点击登录切换服务器按钮可进行切换(当前书源为纯小说阅读)",
    "bookUrlPattern": "",
    "customOrder": -5,
    "enabled": true,
    "enabledCookieJar": true,
    "enabledExplore": true,
    "exploreUrl": "<js>\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let key = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (key) {\n            let keyParts = key.split('secretKey=');\n            if (keyParts.length > 1) {\n                key = keyParts[keyParts.length - 1];\n                setArgument('key', key);\n                return key;\n            }\n        }\n    }\n    return '';  \n }\n\nlet open_argument = source.getVariable();\nlet base_url = getArguments(open_argument,'server');\nlet media = getArguments(open_argument,'media');\nlet keys = getArguments(open_argument,'key');\nif (!keys) {\n\tkeys = gets_key();\n\t}\n\nlet data = {\n    \"男\": {\n        \"玄幻\": 7,\n        \"都市\": 1,\n        \"洪荒\": 66,\n        \"无敌\": 384,\n        \"末世\": 68,\n        \"诸天万界\": 71,\n        \"科幻\": 8,\n        \"星际\": 77,\n        \"重生\": 36,\n        \"系统\": 19,\n        \"神豪\": 20,\n        \"鉴宝\": 17,\n        \"三国\": 67,\n        \"二次元\": 39,\n        \"历史\": 12,\n        \"美食\": 78,\n        \"奶爸\": 42,\n        \"娱乐圈\": 43,\n        \"大唐\": 73,\n        \"外卖\": 75,\n        \"宠物\": 74,\n        \"学霸\": 82,\n        \"游戏动漫\": 57,\n        \"体育\": 15,\n        \"直播\": 69,\n        \"年代\": 79,\n        \"文化历史\": 62,\n        \"海岛\": 40,\n        \"神医\": 26,\n        \"明朝\": 126,\n        \"武侠\": 16,\n        \"灵异\": 100,\n        \"穿越\": 37,\n        \"剑道\": 80,\n        \"都市修真\": 124,\n        \"赘婿\": 25,\n        \"盗墓\": 81,\n        \"推理\": 61,\n        \"无限流\": 70,\n        \"种田\": 23,\n        \"战争\": 97,\n        \"天才\": 90,\n        \"职场\": 127,\n        \"悬疑\": 10,\n        \"成功励志\": 56,\n        \"空间\": 44,\n        \"腹黑\": 92,\n        \"诗歌散文\": 46,\n        \"家庭\": 125,\n        \"影视小说\": 45,\n        \"生活\": 48,\n        \"都市生活\": 2,\n        \"扮猪吃虎\": 93,\n        \"大秦\": 377,\n        \"漫威\": 374,\n        \"火影\": 368,\n        \"西游\": 373,\n        \"龙珠\": 376,\n        \"聊天群\": 381,\n        \"海贼\": 370,\n        \"奥特同人\": 367,\n        \"特种兵\": 375,\n        \"反派\": 369,\n        \"校花\": 385,\n        \"女帝\": 378,\n        \"单女主\": 389,\n        \"神奇宝贝\": 371,\n        \"九叔\": 383,\n        \"求生\": 379,\n        \"无女主\": 391,\n        \"武魂\": 386,\n        \"网游\": 372,\n        \"战神\": 27,\n        \"都市脑洞\": 262,\n        \"都市种田\": 263,\n        \"都市日常\": 261,\n        \"历史脑洞\": 272,\n        \"玄幻脑洞\": 257,\n        \"奇幻仙侠\": 259,\n        \"都市青春\": 396,\n        \"传统玄幻\": 258,\n        \"历史古代\": 273\n    },\n    \"女\": {\n        \"幻想言情\": 32,\n        \"现代言情\": 3,\n        \"现言甜宠\": 395,\n        \"现言脑洞\": 267,\n        \"先婚后爱\": 265,\n        \"都市日常\": 261,\n        \"古言脑洞\": 253,\n        \"古言萌宝\": 249,\n        \"古言甜宠\": 394,\n        \"现言日常\": 269,\n        \"现言复仇\": 268,\n        \"玄幻言情\": 248,\n        \"医术\": 247,\n        \"无敌\": 384,\n        \"种田\": 23,\n        \"萌宝\": 28,\n        \"美食\": 78,\n        \"游戏动漫\": 57,\n        \"娱乐圈\": 43,\n        \"直播\": 69,\n        \"女扮男装\": 388,\n        \"二次元\": 39,\n        \"团宠\": 94,\n        \"无cp\": 392,\n        \"青梅竹马\": 387,\n        \"病娇\": 380,\n        \"科幻\": 8,\n        \"武侠\": 16,\n        \"年代\": 79,\n        \"重生\": 36,\n        \"灵异\": 100,\n        \"公主\": 83,\n        \"甜宠\": 96,\n        \"盗墓\": 81,\n        \"系统\": 19,\n        \"女强\": 86,\n        \"皇后\": 84,\n        \"推理\": 61,\n        \"文化历史\": 62,\n        \"生活\": 48,\n        \"反派\": 369,\n        \"末世\": 68,\n        \"悬疑\": 10,\n        \"穿越\": 37,\n        \"学霸\": 82,\n        \"扮猪吃虎\": 93,\n        \"清穿\": 76,\n        \"穿书\": 382,\n        \"快穿\": 24,\n        \"皇叔\": 87,\n        \"空间\": 44,\n        \"宠妻\": 30,\n        \"豪门总裁\": 29,\n        \"影视小说\": 45,\n        \"成功励志\": 56,\n        \"职场\": 127,\n        \"民国\": 390,\n        \"都市生活\": 2,\n        \"腹黑\": 92,\n        \"星际\": 77,\n        \"天才\": 90,\n        \"古代言情\": 5,\n        \"家庭\": 125,\n        \"兽世\": 72,\n        \"校园\": 4,\n        \"诗歌散文\": 46,\n        \"虐文\": 95,\n        \"嫡女\": 88,\n        \"王妃\": 85,\n        \"精灵\": 89,\n        \"马甲\": 266\n    }\n};\n\nconst groupDatas = [];\nlet infoData = [];\nfunction deviceType() {\n  try {\n    return!!java.androidId();\n  } catch (e) {\n    return false;\n  }\n}\nlet device = deviceType()? 'android' : 'ios';\nif (device == 'android' && (get_key(String(cookie.getCookie('fanqienovel.com') || java.getCookie('fanqienovel.com'))))) {\n    function groupQuery() {\n        const url = base_url + \"/group_name?cookie={{get_key(String(cookie.getCookie('fanqienovel.com') || java.getCookie('fanqienovel.com')))}}\";\n        const res = java.ajax(url);\n        const data = JSON.parse(res).data;\n\n        data.forEach(group => {\n            let key;\n            for (key in group) {\n                groupDatas.push({\n                    \"title\": key,\n                    \"url\": base_url +\"/bookshelf2?page={{page}}&book_ids=\" + group[key].join(\",\"),\n                    \"style\": {\n                        \"layout_flexGrow\": 1,\n                        \"layout_flexBasisPercent\": 0.45\n                    }\n                });\n            }\n        });\n\n        if (groupDatas.length % 2 !== 0) {\n            groupDatas.push({\n                \"title\": \"--\",\n                \"url\": \"\",\n                \"style\": {\n                    \"layout_flexGrow\": 1,\n                    \"layout_flexBasisPercent\": 0.45\n                }\n            });\n        }\n    }\n\n    try {\n    \tjava.longToast(\"请稍等,正在更新分组数据!\");\n    // 用户信息\n    const userUrl = base_url + '/fquser?sessionid={{String(cookie.getKey(\"fanqienovel.com\", \"sessionid\"))}}';\n    const userRes = java.ajax(userUrl);\n    const userInfo = JSON.parse(userRes).data.name;\n\n    infoData = [\n        {\n            \"title\": `${userInfo}个人中心`,\n            \"url\": \"\",\n            \"style\": {\n                \"layout_flexGrow\": 1,\n                \"layout_flexBasisPercent\": 1\n            }\n        }\n    ];\n    groupQuery();\n    } catch (e) {\n    java.longToast(\"网络错误或登录失效或阅读版本过低，请重新登录番茄重试！\");\n    }\n\n}\n\n// 合并数据\nlet datas1 = [\n    {\n        \"title\": \"番茄官方书架\",\n        \"url\": base_url + \"/bookshelf?page={{page}}&cookie={{cookie.getCookie('fanqienovel.com') || java.getCookie('fanqienovel.com')}}\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.45\n        }\n    },\n    {\n        \"title\": \"书山阅读记录\",\n        \"url\": base_url + \"/bookshelf?page={{page}}&key=\" + keys,\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.45\n        }\n    }\n];\n\nconst datas2 = [{\n        \"title\": \"书籍排行榜 ٩( ˃̶͈̀௰˂̶͈́ )و\",\n        \"url\": \"\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 1\n        }\n    },\n    {\n        \"title\": \"推荐榜单\",\n        \"url\": base_url + '/discover?page={{page}}&side_type=10',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"完结榜单\",\n        \"url\": base_url +'/discover?page={{page}}&side_type=11',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"热搜榜单\",\n        \"url\": base_url +'/discover?page={{page}}&side_type=12',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"黑马榜单\",\n        \"url\": base_url +'/discover?page={{page}}&side_type=13',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"爆更榜单\",\n        \"url\": base_url + '/discover?page={{page}}&side_type=15',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"巅峰榜单\",\n        \"url\": base_url +'/discover?page={{page}}&type=0',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"男频精选\",\n        \"url\": base_url + '/discover?page={{page}}&type=2',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"女频精选\",\n        \"url\":base_url + '/discover?page={{page}}&type=3',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    },\n    {\n        \"title\": \"每周推荐\",\n        \"url\": base_url +'/discover?page={{page}}&type=1',\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 0.27\n        }\n    }];\nconst datas = datas1.concat(infoData, groupDatas, datas2);\n\n\nfunction generateUrl(k, k1, sort, status) {\n    return `${base_url}/discover?offset={{(page - 1) * 10}}&limit=10&tags=${data[k][k1]}&status=${status}&sort=${sort}`;\n}\n\nfor (let k in data) {\n    datas.push({\n        \"title\": \"❦ \" + k + \"生频道 ❧\",\n        \"url\": \"\",\n        \"style\": {\n            \"layout_flexGrow\": 1,\n            \"layout_flexBasisPercent\": 1\n        }\n    });\n    for (let k1 in data[k]) {\n        datas.push({\n            \"title\": '༺༴ '+k1+' ༴༻',\n            \"url\": '',\n            \"style\": {\n                \"layout_flexGrow\": 1,\n                \"layout_flexBasisPercent\": 1\n            }\n        });\n        datas.push({\n            \"title\": \"推荐排行\",\n            \"url\": generateUrl(k, k1, 0, 'ALL'),\n            \"style\": {\n                \"layout_flexGrow\": 1,\n                \"layout_flexBasisPercent\": 0.27\n            }\n        });\n        \n        datas.push({\n            \"title\": \"评分排行\",\n            \"url\": generateUrl(k, k1, 1, 'ALL'),\n            \"style\": {\n                \"layout_flexGrow\": 1,\n                \"layout_flexBasisPercent\": 0.27\n            }\n        });\n        \n        datas.push({\n            \"title\": \"热门排行\",\n            \"url\": generateUrl(k, k1, 2, 'ALL'),\n            \"style\": {\n                \"layout_flexGrow\": 1,\n                \"layout_flexBasisPercent\": 0.27\n            }\n        });\n            }\n}\n\n\n\nJSON.stringify(datas);\n</js>",
    "jsLib": "function get_key(cookie){\nlet key;\nkey = cookie.split('secretKey=');\nkey = key[key.length-1];\nreturn key\n}\n\nfunction getArguments(open_argument,key) {\n    try {\n        open_argument = JSON.parse(open_argument);\n    } catch (e) {\n        open_argument = {\n            \"media\": \"全部\",\n            \"server\": \"https://api.shusan.cc\"\n        };\n    }\n    if (key) {return open_argument[key];} else {return open_argument}\n}\n",
    "lastUpdateTime": 1738732832624,
    "loginUi": "[\n      {\n        \"name\":  \"  请杯咖啡，破解限制  \",\n        \"type\": \"button\",\n        \"action\": \"vip()\"\n      },{\n        \"name\":  \"设备管理\",\n        \"type\": \"button\",\n        \"action\": \"clear()\"\n      },{\n        \"name\":  \"服务器地址(可不填)\",\n        \"type\": \"text\"\n        },{\n        \"name\":  \"更新源\",\n        \"type\": \"button\",\n        \"action\": \"api()\"\n      },{\n        \"name\":  \"切换服务器\",\n        \"type\": \"button\",\n        \"action\": \"set_server(server)\"\n      },{\n        \"name\":  \"当前服务器\",\n        \"type\": \"button\",\n        \"action\": \"get_server()\"\n      },{\n        \"name\":  \"♥♥♥♥♥♥填写密钥♥♥♥♥♥♥\",\n        \"type\": \"button\",\n        \"action\":\"loginqt()\"\n      },{\n        \"name\":  \"番茄登录(同步书架)\",\n        \"type\": \"button\",\n        \"action\": \"fq_login()\"\n      },{\n        \"name\":  \" 退出番茄登录 \",\n        \"type\": \"button\",\n        \"action\": \"logout()\"\n      },{\n        \"name\":  \"当前来源\",\n        \"type\": \"button\",\n        \"action\": \"getmedia()\"\n      },{\n        \"name\":  \"搜索全部\",\n        \"type\": \"button\",\n        \"action\": \"set('搜索全部')\"\n      },{\n        \"name\":  \"搜索番茄\",\n        \"type\": \"button\",\n        \"action\": \"set('番茄')\"\n      },{\n        \"name\":  \"搜索七猫\",\n        \"type\": \"button\",\n        \"action\": \"set('七猫')\"\n      },{\n        \"name\":  \"搜索起点\",\n        \"type\": \"button\",\n        \"action\": \"set('起点')\"\n      },{\n        \"name\":  \"搜索得间\",\n        \"type\": \"button\",\n        \"action\": \"set('得间')\"\n      },{\n        \"name\":  \"搜索QQ\",\n        \"type\": \"button\",\n        \"action\": \"set('QQ')\"\n      },{\n        \"name\":  \"搜索熊猫\",\n        \"type\": \"button\",\n        \"action\": \"set('熊猫')\"\n      },{\n        \"name\":  \"搜索轻小说\",\n        \"type\": \"button\",\n        \"action\": \"set('哔哩')\"\n      },{\n        \"name\":  \"搜索聚合\",\n        \"type\": \"button\",\n        \"action\": \"set('聚合')\"\n      }    ]",
    "loginUrl": "function login() {\n    let zdyserver;\n    try {\n        zdyserver = String(source.getLoginInfoMap()['服务器地址(可不填)']);\n        if (zdyserver.includes('http')) {\n            setArgument('server', zdyserver);\n            java.toast(`\\n\\n当前服务器为自定义服务器\\n${zdyserver}\\n\\n切换服务器请先清空服务器地址中的数据`);\n        }\n    } catch (error) {\n    }\n    }\n\n\nlet server = getArgument('server');\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let key = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (key) {\n            let keyParts = key.split('secretKey=');\n            if (keyParts.length > 1) {\n                key = keyParts[keyParts.length - 1];\n                setArgument('key', key);\n                return key;\n            }\n        }\n    }\n\n    return ''; \n}\n\n// 填写密钥\nfunction loginqt(){\n    let key = gets_key()\n    if (key && key != \"\") {\n            java.toast(\"您已填写秘钥:\"+key);\n            return false\n        }\n    java.startBrowserAwait(getArgument('server')+'/check_key','登录书山小说书源');\n    key = gets_key()\n    if (key){\n        java.longToast('登录成功，秘钥：'+key);\n        return true\n        } else {\n            java.toast('登录失败！！！！！');\n            return false\n            }\n}\n\n//登录番茄\nfunction fq_login() {\n    var cookies = cookie.getCookie('fanqienovel.com') || java.getCookie('fanqienovel.com')\n    java.log(cookies)\n    if (cookies && cookies != \"\") {\n        java.toast(\"请不要重复登录，请先退出登录！\")\n        return false\n    }\n    try {\n        java.startBrowserAwait(\"https://fanqienovel.com/\", \"登录\")\n    } catch (e) {\n        java.toast(e)\n    }\n    try {\n        cookie.removeCookie(\"snssdk.com\")\n    } catch (e) {}\n    var cookies = cookie.getCookie(\"fanqienovel.com\")\n    if (!cookies || cookies == \"\") {\n        java.toast(\"登录失败！\")\n        return false\n    }\n    java.toast(\"登录成功！\")\n    return true\n}\n\n//退出番茄\nfunction logout() {\n    cookie.removeCookie(\"fanqienovel.com\");\n    cookie.removeCookie(\"snssdk.com\");\n //cookie.removeCookie(getArgument('server'));\n    java.toast(\"退出登录成功\");\n}\n\n//获取参数\nfunction getArgument(key) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    return open_argument[key];\n}\n\n//设置参数\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\n\t\t\nfunction api() { \tjava.startBrowserAwait(getArgument('server')+'/','首页');\n    }\nfunction hqmy() { \tjava.startBrowserAwait(getArgument('server')+'/key','密钥');\n    }\nfunction vip() { \tjava.startBrowserAwait(getArgument('server')+'/coffee',\"喝咖啡\");\n    }\nfunction clear() { \tjava.startBrowserAwait(getArgument('server')+'/clear',\"清空设备\");\n    }\n\n\nfunction set(media) {\n\t  setArgument('media',media);\n\t  java.toast(\"\\n\\n已切换至：\"+media+'\\n请重新搜索书籍！');\n}\n\n\nfunction getmedia() {\n\t   \tlet media = getArgument('media');\n\t   \tif(media == '') {\n\t   \t\tmedia = '全部来源都搜索';\n\t   \t\t}\n\t\t\t  java.toast(\"\\n\\n当前搜索范围是：\"+media);\n\t\t\t  \n}\n\n//获取服务器\nfunction get_server() {\n\t  var server = getArgument('server');\n    var tishi = '\\n\\n当前服务器：'+ server\n    java.toast(tishi);\n    return server\n}\n\n\n//设置服务器\nfunction set_server() {\n    let zdyserver;\n    try {\n        zdyserver = String(source.getLoginInfoMap()['服务器地址(可不填)']);\n        if (zdyserver.includes('http')) {\n            setArgument('server', zdyserver);\n            java.toast(`\\n\\n当前服务器为自定义服务器\\n${zdyserver}\\n\\n切换服务器请先清空服务器地址中的数据`);\n        } else {\n            zdyserver = '';\n        }\n    } catch (error) {\n        zdyserver = '';\n    }\n    ;\n    if (!zdyserver) {\n        const servers = String(source.bookSourceUrl).split('\\n').map(s => s.trim()).filter(s => s && !s.includes('提示'));\n        const currentServer = getArgument('server') || '';\n        const currentIndex = servers.indexOf(currentServer);\n\n        const nextIndex = currentIndex >= 0 ? (currentIndex + 1) % servers.length : 0;\n        const nextServer = servers[nextIndex];\n\n        setArgument('server', nextServer);\n        java.toast(`\\n\\n当前服务器${nextIndex+1}:${nextServer}\\n\\n注意：切换服务器后需要在详情页刷新目录才能生效`);\n    }\n}",
    "respondTime": 201,
    "ruleBookInfo": {
      "author": "",
      "init": "$..book_id\n<js>\nlet res = result[0];\nlet media = res.split(\"_\")[1] || 'fanqie'\nlet bookid = res.split(\"_\")[0];\nlet sjy = '';\nlet info;\nlet bookUrl = '';\nlet lx = '';\nlet zxtime = '';\nlet zxzj = '';\nlet sy = '';\nlet jj = '';\ntry {\n\t       function setArgument(key, value) {\n        let open_argument = source.getVariable();\n        open_argument = getArguments(open_argument, '');\n        open_argument[key] = value;\n        open_argument = JSON.stringify(open_argument);\n        source.setVariable(open_argument);\n        return open_argument;\n    }\n\n    function gets_key() {\n        var servers = String(source.bookSourceUrl);\n        const serverList = servers.split('\\n');\n\n        for (let server of serverList) {\n            let keys = String(cookie.getCookie(server)) || String(java.getCookie(server));\n            if (keys) {\n                let keyParts = keys.split('secretKey=');\n                if (keyParts.length > 1) {\n                    keys = keyParts[keyParts.length - 1];\n                    setArgument('key', keys);\n                    return keys;\n                }\n            }\n        }\n        return '';\n    }\n\n    let open_argument = source.getVariable();\n    let base_url = getArguments(open_argument, 'server');\n    let ms = getArguments(open_argument, 'media');\n    let key = getArguments(open_argument, 'key');\n    if (!key) {\n        key = gets_key();\n    }\n\n    var tishi = '&nbsp;&nbsp;当前搜索模式：' + ms + '\\n\\n如需切换,请点击登陆进行切换\\n切换之后需要重新搜索！\\n\\n\\u200b'\n    if (media == 'fanqie' || media == 'juxiaoshuo') {\n        try {\n            info = JSON.parse(java.ajax(`${base_url}/novel_detail?&bookid=${bookid}`));\n          try {\n                let shuyuan = info.shuyuan;\n                if (shuyuan) {\n                    let n = 0;\n                    let v = String(book.getVariable(\"custom\"));\n                    let x = v.match(/^\\d+$/) ? v : n;\n                    x = parseInt(x) < shuyuan.length ? x : n;\n                    bookUrl = shuyuan[x];\n                    bookUrl = `${base_url}/detail?bookId=${bookUrl}_juxiaoshuo`;\n                    sjy = `🎯当前书源【${x}】：${shuyuan[x]}`;\n                    sy = info.sy;\n                    lx= info.lx;\n                    zxtime= info.zxtime;\n                    zxzj= info.zxzj;\n                    jj = info.abstract;\n                    jj = `${lx}\n${zxzj}\n${zxtime}\n\\u200b\n${jj}\n\\u200b\n${sjy}\n${sy}`\ninfo = {'abstract': jj}\n                }\n            } catch (error) {\n                info = {'abstract': \"\"}\n            }\n        } catch (error) {\n            info = {'abstract': \"\"}\n        }\n    } else {\n        info = {'abstract': \"\"}\n    }\n\n    if (!key) {\n        jj = '\\n\\n❌️当前用户未填写密钥，请先输入密钥\\n密钥获取途径，书籍详情页，点击右上角点击登陆，获取后，填写，再次刷新详情页'\n    } else if (!info.abstract) {\n        jj = \"\"\n    } else {\n        jj = info.abstract\n    }\nif (!jj){tishi=''}\n    let data = {\n    \t   tishi:tishi,\n        info: jj,\n        bookUrl: bookUrl\n    };\n    JSON.stringify(data);\n} catch (error) {\n    JSON.stringify({info: '', bookUrl: ''});\n}\n</js>",
      "intro": "&nbsp;&nbsp;\n{{$.tishi}}\n{{$.info}}",
      "kind": "",
      "name": "",
      "tocUrl": "bookUrl"
    },
    "ruleContent": {
      "content": "content"
    },
    "ruleExplore": {
      "author": "author",
      "bookList": "$.data.data",
      "bookUrl": "{{$..book_id || ''}}|==|{{$..book_name || ''}}|==|{{$..author || ''}}|==|{{$..thumb_url || ''}}\n<js>\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let keys = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (keys) {\n            let keyParts = keys.split('secretKey=');\n            if (keyParts.length > 1) {\n                keys = keyParts[keyParts.length - 1];\n                setArgument('key', keys);\n                return keys;\n            }\n        }\n    }\n    return '';  \n }\n\nlet open_argument = source.getVariable();\nlet base_url = getArguments(open_argument,'server');\nlet media = getArguments(open_argument,'media');\nlet key = getArguments(open_argument,'key');\nif (!key) {\n\tkey = gets_key();\n\t}\n\n\nlet [book_id, raw_book_name, raw_author, raw_thumb_url] = result.split(\"|==|\");\n\nlet book_name = java.base64Encode(raw_book_name);\nlet author = java.base64Encode(raw_author);\nlet thumb_url = java.base64Encode(raw_thumb_url);\n\nlet catalogue_url = `${base_url}/detail?bookId=${book_id}&book_name=${book_name}&author=${author}&thumb_url=${thumb_url}`;\n\ncatalogue_url\n</js>",
      "coverUrl": "thumb_url",
      "intro": "abstract",
      "kind": "{{$.category}}\n{{$.score}}\n{{$.status}}\n{{$.source}}\n{{$.tags}}",
      "lastChapter": "{{$.last_chapter_title}} • {{$.last_update_time}}",
      "name": "book_name",
      "wordCount": "word_number"
    },
    "ruleSearch": {
      "author": "author",
      "bookList": "$..book_data[*]",
      "bookUrl": "{{$..book_id || ''}}|==|{{$..book_name || ''}}|==|{{$..author || ''}}|==|{{$..thumb_url || ''}}\n<js>\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let keys = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (keys) {\n            let keyParts = keys.split('secretKey=');\n            if (keyParts.length > 1) {\n                keys = keyParts[keyParts.length - 1];\n                setArgument('key', keys);\n                return keys;\n            }\n        }\n    }\n    return '';  \n }\n\nlet open_argument = source.getVariable();\nlet base_url = getArguments(open_argument,'server');\n\n\nlet [book_id, raw_book_name, raw_author, raw_thumb_url] = result.split(\"|==|\");\n\nlet book_name = java.base64Encode(raw_book_name);\nlet author = java.base64Encode(raw_author);\nlet thumb_url = java.base64Encode(raw_thumb_url);\n\nlet catalogue_url = `${base_url}/detail?bookId=${book_id}&book_name=${book_name}&author=${author}&thumb_url=${thumb_url}`;\n\ncatalogue_url\n</js>",
      "checkKeyWord": "我的",
      "coverUrl": "thumb_url",
      "intro": "{{$.media}}小说 \n{{$.abstract}}",
      "kind": "category&&status&&score&&last_chapter_update_time",
      "lastChapter": "{{$.media}}-{{$..book_id}}\n<js>\nfunction lastChapterTitle(media,bookid) {\n   \n    let url;\n    let last;\n    if (media == \"番茄\") {\n    \t    last=fq_last(bookid);\n        return last\n    } else if (media == \"七猫\") {\n    \t   last=qm_last(bookid);\n        return last\n        \n    } else {\n    \treturn ''\n    \t}\n}\n\n\nfunction fq_last(bookid) {\n\tlet url = `https://api5-normal-sinfonlineb.fqnovel.com/reading/bookapi/multi-detail/v/?aid=1967&iid=1&version_code=999&book_id=${bookid}`;\n        let last =JSON.parse(java.ajax(url)).data[0]; \n        return last[\"last_chapter_title\"]+\" · \"+java.timeFormat(last[\"last_chapter_update_time\"]*1000);\n\t\n\t}\n\nfunction qm_last(bookid) {\n\tlet headers={'app-version':'51110','platform':'android','reg':'0','AUTHORIZATION':'','application-id':'com.****.reader','net-env':'1','channel':'unknown','qm-params':''}\n\tsign_key='d3dGiJc651gSQ8w1'\n\nparams={'id':bookid, 'imei_ip':'2937357107','teeny_mode':0}\n\nvar urlEncode = function (param, key, encode) {  \n  if(param==null) return '';  \n  var paramStr = '';  \n  var t = typeof (param);  \n  if (t == 'string' || t == 'number' || t == 'boolean') {  \n    paramStr += '&' + key + '=' + ((encode==null||encode) ? encodeURIComponent(param) : param);  \n  } else {  \n    for (var i in param) {  \n      var k = key == null ? i : key + (param instanceof Array ? '[' + i + ']' : '.' + i);  \n      paramStr += urlEncode(param[i], k, encode);  \n    }  \n  }  \n  return paramStr;  \n};\nparamSign=String(java.md5Encode(Object.keys(params).sort().reduce((pre,n)=>pre+n+'='+params[n],'')+sign_key));\nheaderSign=String(java.md5Encode(Object.keys(headers).sort().reduce((pre,n)=>pre+n+'='+headers[n],'')+sign_key))\nparams['sign']=paramSign;\nheaders['sign']=headerSign;\nlet url = \"https://api-bc.wtzw.com/api/v4/book/detail?\"+urlEncode(params);\noption = {'headers':headers};\nlet last =JSON.parse(java.ajax(url+','+JSON.stringify(option)))[\"data\"][\"book\"];\nlet last2 =  `${last[\"latest_chapter_title\"]} · ${java.timeFormat(last['update_time']*1000)} `\n\treturn last2\n\t}\nlet media = result.split(\"-\")[0];\nlet bookid = result.split(\"-\")[1].split(\"_\")[0];\nlet lasts = lastChapterTitle(media,bookid);\n`${media}: ${lasts}`\n</js>",
      "name": "book_name",
      "wordCount": "word_number"
    },
    "ruleToc": {
      "chapterList": "$..chapterListWithVolume[*].*",
      "chapterName": "title",
      "chapterUrl": "{{$..itemId}}|==|{{$..book_id || ''}}|==|{{$..book_name || ''}}|==|{{$..author || ''}}|==|{{$..thumb_url || ''}}|==|{{$..media || ''}}\n@js:\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let keys = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (keys) {\n            let keyParts = keys.split('secretKey=');\n            if (keyParts.length > 1) {\n                keys = keyParts[keyParts.length - 1];\n                setArgument('key', keys);\n                return keys;\n            }\n        }\n    }\n    return '';  \n }\n\nlet open_argument = source.getVariable();\nlet base_url = getArguments(open_argument,'server');\nlet key = getArguments(open_argument,'key');\nif (!key) {\n\tkey = gets_key();\n\t}\n\n\n// 设备类型检测\nlet device, devicetype;\ntry {\n    devicetype = java.androidId();\n    device = 'android';\n} catch (e) {\n    devicetype = java.deviceID();\n    device = 'ios';\n}\n\n// 数据\nlet [itemId, book_id, book_name, author, thumb_url, media] = result.split(\"|==|\");\n\nif(!key) {\n    java.longToast('\\n\\n请先输入密钥\\n密钥获取途径，书籍详情页，点击右上角点击登陆，获取后，填写，再次刷新详情页');\n}\n\nlet catalogue_url = `${base_url}/reader?item_id=${itemId}&book_id=${book_id}&tone_id=-1&key=${key}&device=${devicetype}&book_name=${book_name}&author=${author}&thumb_url=${thumb_url}&media=${media}`;\n\ncatalogue_url",
      "updateTime": "firstPassTime"
    },
    "searchUrl": "{{key}}\n@js:\nlet search_title = result;\nfunction setArgument(key, value) {\n    let open_argument = source.getVariable();\n    open_argument = getArguments(open_argument,'');\n    open_argument[key] = value;\n    open_argument = JSON.stringify(open_argument);\n    source.setVariable(open_argument);\n    return open_argument;\n}\n\nfunction gets_key() {\n    var servers = String(source.bookSourceUrl);\n    const serverList = servers.split('\\n');\n    \n    for (let server of serverList) {\n        let keys = String(cookie.getCookie(server)) || String(java.getCookie(server));\n        if (keys) {\n            let keyParts = keys.split('secretKey=');\n            if (keyParts.length > 1) {\n                keys = keyParts[keyParts.length - 1];\n                setArgument('key', keys);\n                return keys;\n            }\n        }\n    }\n    return '';  \n }\n\nlet open_argument = source.getVariable();\nlet base_url = getArguments(open_argument,'server');\nlet media = getArguments(open_argument,'media');\nlet key = getArguments(open_argument,'key');\nif (!key) {\n\tkey = gets_key();\n\t}\nbase_url+'/searchNovel?title='+result+'&media='+media",
    "variableComment": "",
    "weight": 63
  },
  {
    "bookSourceComment": "后端php及秘钥by古筝\n书源by  buding大佬\nv5接口by 清词大佬",
    "bookSourceGroup": "古筝的番茄",
    "bookSourceName": "古筝番茄",
    "bookSourceType": 0,
    "bookSourceUrl": "https://fanqie.acgkami.com",
    "customOrder": 0,
    "enabled": true,
    "enabledCookieJar": true,
    "enabledExplore": true,
    "exploreUrl": "@js:\n\nlet sort = [];\npush = (title, url, type) => sort.push({\n    title: title,\n    url: url,\n    style: {\n        layout_flexBasisPercent: type\n    }\n});\n    push('番茄书架', 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=56910&update_version_code=56910', 1);\n    push('巅峰榜单', 'https://fanqienovel.com/api/author/misc/top_book_list/v1/?limit=100&offset=0', 0.29);\n    push('出版榜单', 'https://fanqienovel.com/api/node/publication/list?page_index=0&page_count=100', 0.29);\n    push('爆更榜单', 'https://api-lf.fanqiesdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&limit=50&offset=0&side_type=15&type=1', 0.29);\n    push('黑马榜单', 'https://api-lf.fanqiesdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&limit=50&offset=0&side_type=13&type=1', 0.29);\n    push('热搜榜单', 'https://api-lf.fanqiesdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&limit=50&offset=&side_type=12&type=1', 0.29);\t\n    push('每周推荐', 'https://fanqienovel.com/api/rank/recommend/list?type=1&limit=10&offset=0', 0.29);\t\n\t\n\tA=[[\"推荐\",\"10\"],[\"完结\",\"11\"],[\"热搜\",\"12\"]]\t;\n[[\"男频\",\"1\"],[\"女频\",\"0\"]].map([title,id]=>{\n\tpush('❤️'+title+'榜单❤️', null, 1);\n\tif(id==2){ \tA=A.slice(1,A.length-1) }\n\t\tA.map([title,uri]=>{\t\t\t\n\t\t  \turl= `https://novel.snssdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&app_name=news_article&app_version=9.7.3&channel=tengxun_tt&device_platform=android&os=android&device_type=ProjectTitan&os_api=29&os_version=10&openlive_plugin_status=1&isTTWebViewHeifSupport=0&limit=100&offset={{(page-1)*100}}&side_type=${uri}&type=${id}`;\n\t\t\t\tpush(title, url, 0.29);\t\t\t\n\t\t\t});\n\t});\t\n\t\n\tcategory = () =>{\n\t\t\tcategory_url = \"https://novel.snssdk.com/api/novel/channel/homepage/new_category/page/data/v1/?aid=13\";\nreturn  JSON.parse(java.ajax(category_url)).data\t\t\n\t\t}\n\t\t  \n  json = (data) => {\n     boy = data.boy_category;\n     girl = data.girl_category;\n     publish = data.publish_category;\n     json = [[\"男频\",\"gender=1\",boy],[\"女频\",\"gender=0\",girl],[\"出版\",\"genre_type=160\",publish]];\n     return JSON.parse(JSON.stringify(json));\n   }\t\n\t\tjson(category()).map([tit1,gender,category]=>{\n\t    push('❤️'+tit1+'❤️', null, 1);\n     category.map(($,index)=>{\n     \tindex++;\n\t    title = $.category_name;\n     \tcid = $.category_id;\n\t    url=  `https://novel.snssdk.com/api/novel/channel/homepage/new_category/book_list/v1/?aid=1967&app_name=news_article&app_version=9.7.3&channel=tengxun_tt&creation_status=9&device_platform=android&enter_from=novel_category&novel_host&novel_version&version_code=973&version_name=9.7.3&word_count=9&os=android&device_type=ProjectTitan&os_api=29&os_version=10&offset={{(page-1)*100}}&limit=100&category_id=${cid}&${gender}`;\n\t\t\t\tpush(title, url, 0.29);\t\n      });\n  });\nJSON.stringify(sort);",
    "jsLib": "let replaceCover = (u) => {\n  if (u.startsWith(\"https://\")) u = u.substring(8)\n  else u = u.substring(7)\n  let uArr = u.split(\"/\")\n  uArr[0] = \"https://p6-novel.byteimg.com/origin\"\n  let uArr2 = []\n  uArr.forEach((x) => {\n    if (!x.includes(\"?\") && !x.includes(\"~\")) uArr2.push(x)\n    else uArr2.push(x.split(\"~\")[0])\n  })\n  u = uArr2.join(\"/\")\n  return u\n}\n\nfunction getNovelComment(book_id, type) {\n    const { java, source, book } = this\n    if (type == 0) {\n    let count = book.getVariable(\"custom\")\n    if (count && count == \"\") count = 20\n    let res = java.ajax(`https://changdunovel.com/reading/ugc/novel_comment/book/v1?query_type=0&offset=0&count=${count}&sort=create_time&need_hot_comment=0&book_id=${book_id}&aid=1967&addQueryPrefix=true`) \n    let comments = JSON.parse(res).data.comment\n    let result = `${comments.length>0?(\"(共 \"+ comments.length +\" 条)\"):\"\"}\\n`\n    comments.forEach(c => {\n        let startNum = 5 - parseInt(c.score/2)\n        result += `${c.user_info.gender==1?\"👨🏻\":\"👱🏻\"} ${c.user_info.user_name} || ${\"★★★★★★☆☆☆☆☆\".slice(startNum, startNum + 5)}\\n${c.text.replace(/###\\s/g,'')}\\n&lrm;\\n`\n    })\n    return result\n    } \n  result = \"\"\n  return result\n}",
    "lastUpdateTime": 1753703976925,
    "loginCheckJs": "if (source.getVariable()==\"\") {\n    source.setVariable(\"v1\")\n}\nresult",
    "loginUi": "[{\n    \"name\": \"密钥\",\n    \"type\": \"password\",\n    \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\": 0.4\n    }\n  },\n  {\n    \"name\": \"获取密钥\",\n    \"type\": \"button\",\n    \"action\": \"getkey()\",\n    \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\": 0.4\n    }\n  },\n  {\n    \"name\": \"番茄登录\",\n    \"type\": \"button\",\n    \"action\": \"getcookie()\",\n    \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\": 0.4\n    }\n  },\n  {\n    \"name\": \"正文接口\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 1\n  }\n},\n  {\n    \"action\": \"setjk('v1')\",\n    \"name\": \"V1\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n    \"action\": \"setjk('v2')\",\n    \"name\": \"V2\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n    \"action\": \"setjk('v3')\",\n    \"name\": \"V3\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n    \"action\": \"setjk('v4')\",\n    \"name\": \"V4\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n    \"action\": \"setjk('v5')\",\n    \"name\": \"V5\",\n    \"type\": \"button\",\n    \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n}\n]",
    "loginUrl": "function login(){}\nfunction getkey(){\tjava.startBrowserAwait('https://fanqie.acgkami.com', \"获取密钥\");\n}\nfunction getcookie(){\tjava.startBrowserAwait('https://fanqienovel.com/', \"番茄登录\");\n}\nfunction setjk(jk){\n\tsource.setVariable(jk)\n\tjava.toast(\"正文接口已切换至\"+jk)\n\t}",
    "respondTime": 180000,
    "ruleBookInfo": {
      "author": "$..author",
      "coverUrl": "@js:replaceCover(java.getString(\"$..thumb_url\"))",
      "init": "<js>\nbook_id=java.hexDecodeToString(result)\nurl=`https://fanqie.acgkami.com/book.php?book_id=${book_id}&sign={{source.getLoginInfoMap().get('密钥')}}`\nresult=java.ajax(url)\n</js>\n$.data[*]",
      "intro": "&nbsp;&nbsp;\n📕 源名：{{$..original_book_name}}\n📔 别名：{{$..book_flight_alias_name}}\n🆔 编号：{{$..book_id}}\n📇 状态：__status__-连载{{$..creation_status}}完结\n✏️ 开坑：{{$..create_time##T|\\+.*## }}\n🕰 更新：{{java.timeFormatUTC(java.getString(\"$..last_chapter_update_time\")*1000,'yyyy-MM-dd HH:mm:ss',28800000)}}\n⌨️ 字数：{{$..word_number}}字\n👤 主角：{{$..roles##\\[|\\\"|\\]}}\n📊 评分：{{$..score}}分\n👁️ 在线：{{$..read_count}}人在读\n🔗 源站：{{$..source##，.*|授权发行##}}\n📜 简介：\n{{$..abstract}}\n📝 书评：{{getNovelComment(java.getString(\"$..book_id\"),java.get(\"type\"))}} \n📍 {{$..copyright_info##，.*|信息##}}\n##连载0|1完结|男生0|1女生\n@js:result.replace(/...别名+：\\n/g,\"\").replace(/....数+：\\n/,\"\").replace(/....评+：\\n/,\"📝 书评：无\").replace(/....角+：\\n/,\"\").replace(\"男生2女生\",\"出版\").replace('__status__', (java.getString('$..book_search_visible') == 'true' ? '正常' : (java.getString('$..tomato_book_status') == '3' ? '下架' : '小黑屋')))\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "kind": "男生{{$..gender}}女生\n{{$..category}}\n连载{{$..creation_status}}完结\n{{$..score}}分\n{{java.timeFormatUTC(java.getString(\"$..last_chapter_update_time\")*1000,'yyyy-MM-dd',28800000)}}\n##连载0|1完结|男生0|1女生\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "lastChapter": "$..last_chapter_title",
      "name": "$..book_name##（别名：.*?）",
      "tocUrl": "$..book_id\n<js>\n`data:;base64,${java.base64Encode(result)},{\"type\":\"古筝\"}`\n</js>",
      "wordCount": "$..word_number"
    },
    "ruleContent": {
      "content": "<js>\nitemId=java.hexDecodeToString(result)\nurl=`https://fanqie.acgkami.com/content.php?item_id=${itemId}&source={{source.getVariable()}}&sign={{source.getLoginInfoMap().get('密钥')}}`\nresult=JSON.parse(java.ajax(url)).content\n</js>\n@@p@html"
    },
    "ruleExplore": {
      "author": "$.author##</?em>",
      "bookList": "<js>\nlet list = [];\nlet resultData = JSON.parse(result);\n\nlet targetData = resultData.data || resultData.list || resultData.book_list || \n                resultData.publication_list || resultData.result || resultData;\n                \nif (targetData != null && targetData.book_shelf_info) {\n    let bookIds = targetData.book_shelf_info.map(item => `{\"book_id\": \"${item.book_id}\"}`).join(',');\n    \n    let booksData = java.ajax(\n`https://fanqienovel.com/api/bookshelf/multidetail,{\"method\": \"post\",\"body\": {\"books\":[${bookIds}]}}`\n        );\n    \n    let books = JSON.parse(booksData).data.detail_list;\n    for (let i in books) {\n        let d = books[i];\n        list.push({\n            src: d,\n            book_name: d.book_name,\n            author: d.author,\n            category:d.category,\n            tags:d.tags,\n            word_number:d.word_number,\n            lastChapterTitle: d.last_chapter_title,\n            abstract: d.abstract,\n            book_id: d.book_id,\n        });\n    }\n} else {\n    list = targetData.content || targetData;\n}\n\nJSON.stringify({data: list})\n</js>\ndata.data||data.list||book_list||data.publication_list||data.result||data",
      "bookUrl": "$.book_id||$.bookId\n<js>\n`data:;base64,${java.base64Encode(result)},{\"type\":\"古筝\"}`\n</js>",
      "coverUrl": "http://p6-novel.byteimg.com/large/{$.thumb_uri}||$.thumb_url||thumbUri",
      "intro": "$.abstract",
      "kind": "$.category&&$.source",
      "lastChapter": "$.last_chapter_title",
      "name": "$.book_name||$.bookName",
      "wordCount": "$.word_number"
    },
    "ruleSearch": {
      "author": "author",
      "bookList": "data.ret_data[*]",
      "bookUrl": "book_id\n<js>\n`data:;base64,${java.base64Encode(result)},{\"type\":\"古筝\"}`\n</js>",
      "coverUrl": "@js:replaceCover(java.getString(\"thumb_url\"))",
      "intro": "abstract",
      "kind": "连载{{$.creation_status}}完结\n{{$.score}}分\n{{$.category}}\n##连载0|1完结\n@js:result\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "name": "title##（别名.*?）"
    },
    "ruleToc": {
      "chapterList": "<js>\nbook_id=java.hexDecodeToString(result)\nurl=`https://fanqie.acgkami.com/xq.php?book_id=${book_id}&sign={{source.getLoginInfoMap().get('密钥')}}`\nr=JSON.parse(java.ajax(url)).data.chapterListWithVolume\nJSON.stringify(r)\n</js>$[*].[*]",
      "chapterName": "$.title",
      "chapterUrl": "$.itemId\n<js>\n`data:;base64,${java.base64Encode(result)},{\"type\":\"古筝\"}`\n</js>",
      "updateTime": "{{$.volume_name}} | {{java.timeFormatUTC(java.getString(\"firstPassTime\") * 1000, 'yyyy-MM-dd HH:mm:ss',28800000)}}\n@js:\nif (result.startsWith(\" |\")) result = result.slice(2)\nif (result.startsWith(\"| \")) result = result.slice(2)\nresult"
    },
    "searchUrl": "https://fanqie.acgkami.com/search.php?key={{key}}&page={{page}}\n@js:\nif (key.length == 19 && !Number.isNaN(parseInt(key))) {\n  result = `data:;base64,${java.base64Encode(key)},{\"type\":\"古筝\"}`\n}\nresult",
    "weight": 0
  },
  {
    "bookSourceComment": "支持:番茄 七猫 猫眼 得间  书旗 滴滴",
    "bookSourceGroup": "🍅番茄",
    "bookSourceName": "🍅聚合书源",
    "bookSourceType": 0,
    "bookSourceUrl": "https://fqphp.gxom.cn/",
    "customOrder": 4,
    "enabled": true,
    "enabledCookieJar": true,
    "enabledExplore": true,
    "exploreUrl": "@js:\n\nlet type = [\"番茄小说\", \"番茄短剧\",\"七猫小说\", \"书旗小说\", \"得间小说\", \"猫眼看书\", \"滴滴小说\"];  \nlet 番茄小说 = [\"书架\", \"都市\", \"探案\", \"历史\", \"异界\", \"游戏\", \"奥特\", \"万界\", \"盗墓\", \"明星\", \"动漫\", \"脑洞\", \"灵异\", \"悬疑\", \"玄幻\", \"仙侠\", \"无敌\", \"大秦\", \"明朝\", \"三国\", \"大唐\", \"宋朝\", \"清朝\", \"推理\", \"鉴宝\", \"海贼\", \"武将\", \"国运\", \"乡村\", \"洪荒\", \"空间\", \"群聊\"];  \nlet 番茄短剧 = [\"逆袭\", \"总裁\", \"现言\", \"打脸\", \"马甲\", \"豪门\", \"都市\", \"神豪\"]; \nlet 七猫小说 = [\"都市\", \"异术\", \"玄幻\", \"武侠\", \"奇闻\", \"历史\", \"游戏\", \"科幻\", \"体育\", \"影视\", \"穿越\", \"鉴宝\", \"重生\", \"血脉\", \"签到\", \"复仇\", \"丹药\", \"医生\", \"战神\", \"皇帝\", \"热血\", \"爽文\", \"悬疑\", \"弃少\"];  \nlet 书旗小说 = [\"都市\", \"玄幻\", \"仙侠\", \"灵异\", \"历史\", \"游戏\", \"科幻\", \"奇幻\", \"竞技\", \"现言\", \"古言\", \"校园\"];  \nlet 得间小说 = [\"都市\", \"玄幻\", \"仙侠\", \"武侠\", \"科幻\", \"校园\", \"游戏\", \"历史\"];  \nlet 猫眼看书 = [\"玄幻\", \"武侠\", \"都市\", \"仙侠\", \"军事\", \"历史\", \"游戏\", \"科幻\"];  \nlet 滴滴小说 = [\"玄幻\", \"都市\", \"武侠\", \"仙侠\", \"军事\", \"历史\", \"游戏\", \"科幻\"];  \n\nJSON.stringify(  \n    type.reduce((arr, x) => {  \n        arr.push({  \n            title: x,  \n            url: \"\",  \n            style: { layout_flexBasisPercent: 1 }  \n        });  \n        eval(x).forEach(k => {  \n            arr.push({  \n                title: k,  \n                url: `{{source.bookSourceUrl}}syfx?lx=${x}&ck=${ck()}&fl=${k}&page={{page}}`,  \n                style: { layout_flexBasisPercent: 0.2 }  \n            });  \n        });  \n        return arr;  \n    }, [])  \n);",
    "jsLib": "function ck() {\n    let ck = String(this.cookie.getCookie(\"fanqienovel.com\").match(/sessionid=([^;]*)/)?.[1] || '');\n    return ck;\n}\n\n\nfunction Map(e) {\n    const { source } = this;\n    var infomap = source.getLoginInfoMap();\n    try {\n        return String(infomap[e]);\n    } catch (err) {\n        return \"\";\n    }\n}\n\nfunction W() {\n    let W = String('7jK9pR2sL5qW').replace(/j|W|p|9|R|5/g, \"\");\n        return W;\n}\n\n\n   \n\n\n    ",
    "lastUpdateTime": 1753902906904,
    "loginUi": "\n[\n \t \n{\n        name: \" 获取密钥 \",\n        type: \"button\",\n        action: \"my(my)\",\n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 0.45\n    \t\t \t}\n    },\n\n{\n        name: \" 书源更新 \",\n        type: \"button\",\n        action: \"renderVersionPage()\",\n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 0.45\n    \t\t \t}\n    },\n\n   \n  {\n        name: \" 开启段评 \",\n        type: \"button\",\n        action: \"kqdp(kqdp)\",\n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 0.45\n    \t\t \t}\n    },\n\n{\n        name: \" 关闭段评 \",\n        type: \"button\",\n        action: \"gbdp(gbdp)\",\n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 0.45\n    \t\t \t}\n    },\n    {\n        name: \"密钥\",\n        type: \"password\",       \n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 1\n    \t\t \t}\n    },\n{\n        name: \"颜色\",\n        type: \"text\",       \n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 1\n    \t\t \t}\n    },\n{\n        name: \"气泡\",\n        type: \"text\",       \n    \t\t style: {\n    \t\t \tlayout_flexGrow: 1,\n    \t\t \tlayout_flexBasisPercent: 1\n    \t\t \t}\n    }\n\n]",
    "loginUrl": "\nfunction login() {}\n\nfunction my(my) {\njava.startBrowserAwait(source.bookSourceUrl+'userd.php',\"获取密钥\");\n}\n\nfunction kqdp(kqdp) {\njava.put(\"dp\", \"开启\");\njava.toast(\"段评开启\");\n}\n\nfunction gbdp(gbdp) {\njava.put(\"dp\", \"关闭\");\njava.toast(\"段评关闭\");\n}\n\nfunction renderVersionPage() {\n  let html = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>fqphp_书源更新</title>\n  <style>\n    :root {\n      --md-blue-primary: #2196F3;\n      --md-blue-dark: #1976D2;\n      --md-blue-light: #BBDEFB;\n      --md-gray-light: #f5f5f5;\n      --md-text-primary: #212121;\n      --md-text-secondary: #757575;\n    }\n\n    body { \n      margin: 0; \n      padding: 1em; \n      font-family: 'Roboto', 'Segoe UI', sans-serif; \n      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); \n      display: flex; \n      justify-content: center; \n      align-items: center; \n      min-height: 100vh; \n    }\n    \n    .container { \n      width: 100%; \n      max-width: 480px; \n      background: white; \n      border-radius: 8px; \n      padding: 2em 1em; \n      box-shadow: 0 2px 10px rgba(0,0,0,0.1); \n      text-align: center; \n    }\n    \n    .button { \n      display: block; \n      width: 90%; \n      margin: 0 auto 1em; \n      padding: 0.85em; \n      text-align: center; \n      font-size: 1em; \n      border: none; \n      border-radius: 4px; \n      text-decoration: none; \n      background: var(--md-blue-primary); \n      color: white; \n      font-weight: 500; \n      transition: all 0.2s ease; \n      box-shadow: 0 2px 5px rgba(0,0,0,0.2); \n    }\n    \n    .button:hover { \n      background: var(--md-blue-dark); \n      box-shadow: 0 4px 8px rgba(0,0,0,0.25); \n      transform: translateY(-1px); \n    }\n    \n    .button:active { \n      transform: translateY(1px); \n      box-shadow: 0 1px 3px rgba(0,0,0,0.2); \n    }\n\n    .tutorial-button {\n      background: #4CAF50;\n    }\n    \n    .tutorial-button:hover {\n      background: #388E3C;\n    }\n    \n    .logs { \n      background: white; \n      padding: 1.2em; \n      border-radius: 4px; \n      border: 1px solid #e0e0e0; \n      text-align: left; \n      margin-top: 1em;\n    }\n    \n    .logs h2 { \n      font-size: 1.1em; \n      margin: 0 0 0.8em 0; \n      padding-bottom: 0.3em; \n      color: var(--md-blue-primary); \n      border-bottom: 1px solid var(--md-blue-light); \n      font-weight: 500; \n    }\n    \n    .log-item { \n      line-height: 1.6; \n    }\n    \n    .log-item-date { \n      font-weight: 500; \n      color: var(--md-text-primary); \n    }\n    \n    .log-item-content { \n      margin-left: 0.1em; \n      color: var(--md-text-secondary); \n    }\n\n    #tutorialPage {\n      display: none;\n      padding: 1.5em;\n      text-align: left;\n    }\n\n    .tutorial-title {\n      color: var(--md-blue-primary);\n      font-size: 1.3em;\n      margin-bottom: 1em;\n      font-weight: 500;\n    }\n\n    .tutorial-step {\n      margin-bottom: 1.2em;\n      line-height: 1.6;\n    }\n\n    .step-number {\n      display: inline-block;\n      width: 24px;\n      height: 24px;\n      background: var(--md-blue-primary);\n      color: white;\n      border-radius: 50%;\n      text-align: center;\n      line-height: 24px;\n      margin-right: 8px;\n      font-size: 0.9em;\n    }\n\n    .back-button {\n      background: var(--md-text-secondary);\n      margin-top: 1.5em;\n    }\n\n    .back-button:hover {\n      background: #616161;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n   \n    <div id=\"mainPage\">\n      <a href=\"legado://import/auto?src=${source.bookSourceUrl}/fqphp.json\" class=\"button\">更新书源</a>\n      <a href=\"https://t.me/Fqphp\" class=\"button\">加入电报</a>\n      <a href=\"javascript:showTutorial()\" class=\"button tutorial-button\">查看教程</a>\n      \n      <div class=\"logs\">\n        <h2>更新记录</h2>\n        <div class=\"log-item\">\n          <div class=\"log-item-date\">2025-07-29</div>\n          <div class=\"log-item-content\">·修复登录相关BUG</div><br>\n          <div class=\"log-item-date\">2025-07-26</div>\n          <div class=\"log-item-content\">·修复段评相关BUG</div>\n        </div>\n      </div>\n    </div>\n\n    <div id=\"tutorialPage\">\n     \n      <div class=\"tutorial-step\">\n        <span class=\"step-number\">1</span>\n        <span>点击\"段评开启 关闭\"按钮,可以打开段评,安卓长按气泡点击刷新,源阅长按气泡即可!</span>\n      </div>\n      \n      <div class=\"tutorial-step\">\n        <span class=\"step-number\">2</span>\n        <span>关于密钥相关使用gitee登录即可获取密钥,点击小眼睛查看完整密钥填入保存即可!</span>\n      </div>\n      \n      <div class=\"tutorial-step\">\n        <span class=\"step-number\">3</span>\n        <span>气泡有三款样式,填入 0 1 2 即可查看对应气泡样式,如果你有能力自行更改SVG!</span>\n      </div>\n      \n      <div class=\"tutorial-step\">\n        <span class=\"step-number\">4</span>\n        <span>颜色即气泡颜色,十六进制颜色比如: #ffffff #000000 遇到问题可加入电报群聊获取帮助!</span>\n      </div>\n      \n      <a href=\"javascript:showMain()\" class=\"button back-button\">返回页面</a>\n    </div>\n  </div>\n\n  <script>\n    // 显示教程页面\n    function showTutorial() {\n      document.getElementById('mainPage').style.display = 'none';\n      document.getElementById('tutorialPage').style.display = 'block';\n    }\n\n    // 显示主页面\n    function showMain() {\n      document.getElementById('tutorialPage').style.display = 'none';\n      document.getElementById('mainPage').style.display = 'block';\n    }\n  </script>\n</body>\n</html>\n`;\n  java.startBrowser(`data:text/html;base64,${java.base64Encode(html)}`, 'fqphp_书源更新');\n}",
    "respondTime": 5956,
    "ruleBookInfo": {},
    "ruleContent": {
      "content": "@js:\nlet url = java.hexDecodeToString(result);\n\nlet response = java.ajax( url + \"&key=\" + Map(\"密钥\") + \"&ban=\" + W()\n);\n\nlet content = JSON.parse(response).data.content;\n\nif (java.get(\"dev\") == \"android\" && url.includes(\"%E7%9F%AD%E5%89%A7\") && book.durChapterIndex == chapter.index) {\n\tlet dj = `{{source.bookSourceUrl}}dpurl?url=${chapter.bookUrl}&ban=${W()}&key=${Map(\"密钥\")}`;\n    java.startBrowser(dj,chapter.title);\n    content = \"刷新播放\"; \n} else\nif (java.get(\"dp\") == \"开启\" && /fq_id|qm_id/.test(book.bookUrl) && String(content).length > 0) {\n\t  type = book.bookUrl.match(/(.{2})_id=/)[1]\n\t  content = content.replace(/\\n+/g,\"\\n\")\n    bid = book.bookUrl.match(/(fq|qm)_id=(\\d+)/)[2];\n    cid = chapter.url.match(/(item_id|chapter_id)=(\\w+)/)[2];\n    version = chapter.url.match(/version=(\\w+)/)?.[1];\n    getComments(type, content, bid, cid, version);\n} else {\n    content;\n};",
      "imageStyle": "TEXT"
    },
    "ruleExplore": {
      "author": "author",
      "bookList": "$.data.books[*]",
      "bookUrl": "url",
      "coverUrl": "src",
      "intro": "intro",
      "kind": "mmfl",
      "name": "name"
    },
    "ruleSearch": {
      "author": "$.author",
      "bookList": "$.data.books",
      "bookUrl": "$.url",
      "checkKeyWord": "系统@番茄",
      "coverUrl": "$.src",
      "intro": "$.intro",
      "kind": "$.mmfl",
      "name": "$.name"
    },
    "ruleToc": {
      "chapterList": "<js>\nfunction deviceType() {\n  try {\n    return !!java.androidId();\n  } catch (e) {\n    return false;\n  }\n}\nlet device = deviceType() ? 'android' : 'ios';\njava.put(\"dev\", device)\nlet url = baseUrl?.match(/&ts=([^&]*)/)?.[1] || null;\n\n// 直接根据 url 和设备类型判断模式并赋值  \nif (device === 'android') {  \n  if (url === \"听书\") {  \n    book.type = 32;  \n    java.longToast(\"已自动切换为听书!\");  \n  } else if (url === \"漫画\") {  \n    book.type = 64;  \n    java.longToast(\"已自动切换为漫画!\");  \n  } else {  \n    book.type = 8;  // 安卓普通阅读模式  \n  }  \n} else if (device === 'ios') {  \n  if (url === \"听书\") {  \n    book.type = 1;  \n    java.longToast(\"已自动切换为听书!\");  \n  } else if (url === \"漫画\") {  \n    book.type = 2;  \n    java.longToast(\"已自动切换为漫画!\");  \n  } else if (url === \"短剧\") {  \n    book.type = 3;  \n    java.longToast(\"已自动切换为视频!\");  \n  }else {  \n    book.type = 0;  // iOS 普通阅读模式  \n  }  \n}\n\nlet bid = baseUrl.match(/\\?(fq|qm)_id=([^&]*)/)?.[2]\nif (book.bookUrl.includes(\"fq_id\")){\n\tvar type = \"fqbzpl\"\n\tvar cname = \"item_id\"\n\t} else if (book.bookUrl.includes(\"qm_id\")) {\n\t\tvar type = \"qmbzpl\"\n\t\tvar cname = \"chapter_id\"\n\t\t}\n\n\n\n\nJSON.parse(result).data.lists.map((x) => {\n    let match = x.url.match(/item_id=([^&]+)|chapterId=\\d+-(\\d+)/);\nlet cid = match ? (match[1] || match[2]) : null;\n    x.url = `data:chapterUrl;base64,${java.base64Encode(\n        x.url\n    )},{\"type\":\"\",\"js\":\"book ? result :'${source.bookSourceUrl}${type}?book_id=${bid}&${cname}=${cid}&version=${x.version?? \"\"}&sessionid=${ck()}&key=${Map(\"密钥\")}'\"}`;\n\n   return x;\n});\n</js>",
      "chapterName": "title",
      "chapterUrl": "url"
    },
    "searchUrl": "search?wd={{key}}&page={{page}}",
    "weight": 0
  },
  {
    "bookSourceComment": "搜索接口@情无羁\n理论上是可以下载的 但是建议还是低并发（接口随时会被关闭 使用的未被验证的token）\n交流反馈群：640118388",
    "bookSourceGroup": "妍希",
    "bookSourceName": "六九书吧(直连可下载)",
    "bookSourceType": 0,
    "bookSourceUrl": "http://111.170.33.6:49988",
    "concurrentRate": "1000",
    "customOrder": 5,
    "enabled": true,
    "enabledCookieJar": false,
    "enabledExplore": false,
    "header": "@js:\nJSON.stringify({\n\t\"x-sec-token\": \"8f79170487338570cdbb178e4653ed25943a6af05f3c29043782de49fc7a8fbd2446589412f746e396a05744cf546027bc63d7391b0e86ff3551c4d8e52ac1f97a2492bcc15dba6a9e2181084ed6e3f2a4d8a7e5aa419a705c5cffc8a93f5827fce376e3c3df14b8498405ba5f2630c0fa948894f4f7e5e26840f431f50396e9\"\n\t})",
    "lastUpdateTime": 1752849813506,
    "respondTime": 180000,
    "ruleBookInfo": {
      "author": "author",
      "coverUrl": "cover",
      "intro": "<br> 🕰 更新时间：{{$.update}}\n 📖 最新章节：{{$.last}}\n 🏷️ 标签：{{$.tags}}丨{{$.else}}章\n 📜 简介：{{$.info}}",
      "kind": "tags##\\|##,",
      "lastChapter": "{{$.last}} · {{$.update}}",
      "name": "bookname",
      "tocUrl": "http://111.170.33.6:49988/69shuba/chapters.php?bookId={{$.bookId}}",
      "wordCount": "{{$.else}}章"
    },
    "ruleContent": {
      "content": "content"
    },
    "ruleExplore": {},
    "ruleSearch": {
      "author": "author",
      "bookList": "data[*]",
      "bookUrl": "surl##.*\\/(\\d+).htm##http://111.170.33.6:49988/69shuba/detail.php?bookId=$1",
      "coverUrl": "cover",
      "intro": "description",
      "name": "title"
    },
    "ruleToc": {
      "chapterList": "-$.chapters[*]",
      "chapterName": "name",
      "chapterUrl": "{{baseUrl}}##.*=(\\d+)##http://111.170.33.6:49988/69shuba/content.php?bookId=$1&chapterId={{$.id}}"
    },
    "searchUrl": "http://111.170.33.6:49988/69shuba/search.php?key={{key}}&page={{page}}",
    "weight": 0
  },
  {
    "bookSourceComment": "支持纯bookid搜书,支持下架,黑屋等小说正文阅读\n附：本书源仅支持小说，仅支持小说，仅支持小说！！！\n部分发现需要登录才能使用\n交流反馈群：640118388\n修复下架书籍无书名的情况",
    "bookSourceGroup": "妍希",
    "bookSourceName": "番茄小说（不限制下载）",
    "bookSourceType": 0,
    "bookSourceUrl": "http://111.170.33.6:49988/",
    "customOrder": 8,
    "enabled": true,
    "enabledCookieJar": true,
    "enabledExplore": true,
    "exploreUrl": "@js: \n个人中心 = 1 \n \njs = (cid, genre, gender) => `@js:\nsource.key + \"/reading/bookapi/new_category/landing/v/?\" + [\n    \"category_id=${cid}\",\n    \"limit=50\",\n    \"offset=\" + (page - 1),\n    \"gender=${gender}\",\n    \"genre=${genre}\"\n  ].join(\"&\")`\n\nreadHistory = (path) => `@js:\nlet ck = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : source.getLoginInfoMap()['手动登录Token'])\n\"{{source.key}}/multi-detail?book_id=\" + getBookId(java.ajax('https://reading.snssdk.com/reading/bookapi/read_history/list/v/?aid=1967&version_code=99999,{\"headers\":{\"Cookie\":\"install_id=2531502907244067;' + ck + '\"}}'), page-1)`\n\t\n\t\nobj = (title, url, type, type1) => ({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n})\n\narr = []\njava.longToast(\"请稍等，发现列表正在热更新！\")\nindex=[0, 1, 2]\nfor (let i of index) {\n  // java.toast(i)\n  let type = i\n  $ = JSON.parse(java.ajax(source.key + \"/reading/bookapi/new_category/front/v/?\" + [\n      \"update_version_code=99999\",\n      \"distinct_style=1\",\n      \"new_category_tab=\" + i\n    ].join(\"&\")\n  )).data.category_tab_data\n  cate = []\n  cate.push(obj(\n    \"====== \" + $.tab_name + \" ======\", \"\", 1\n  ))\n  $.cell_data.forEach((c) => {\n    gender_1 = (type == 0 || type == 1) ? type : 1;\n    genre_1 = type == 3 ? 1 : type == 5 ? 110 : type == 6 ? 130 : 0;\n    cate.push(obj(\n      c.cell_name,\n      js(c.atom_data[0].category_data.category_id, genre_1, gender_1),\n      1\n    ))\n    for (j = 2; j < 5; j++) {\n      c.atom_data.slice(1).forEach((a) => {\n        d = a.category_data\n        if (d.name.length == j) {\n          cate.push(obj(d.name, js(d.category_id, genre_1, gender_1), -1))\n        }\n      })\n    }\n  })\n  arr = cate.concat(arr)\n}\n\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=99999&update_version_code=57700'\nlet book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']),\n  }\n})))\n \njava.log(JSON.stringify(book_shelf_info))\n\nlet username\nif (book_shelf_info.code != 0) {\n  个人中心 = 0\n  // source.setVariable('{}')\n} else {\n  let uinfo = java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({ headers: { Cookie: \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) }}))\n  let arrB = []\n  for (let i of book_shelf_info.data.book_shelf_info) {\n    arrB.push(i.book_id)\n  }\n  uinfo = JSON.parse(uinfo)\n  write_config('bookshelf.' + uinfo.data.id, arrB)\n  write_config('userinfo', { name: uinfo.data.name, userid: uinfo.data.id })\n  username = uinfo.data.name\n}\n\nlet gro = []\npush = (title, url, type) => gro.push({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n});\n\nlet sArr = []\n\nif (个人中心) {\n  let groups_bookids = {\n    \"组外\": []\n  }\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!groups_bookids[i.group_name ? i.group_name : \"组外\"]) groups_bookids[i.group_name] = []\n    groups_bookids[i.group_name ? i.group_name : \"组外\"].push(i.book_id)\n  })\n\n  Object.keys(groups_bookids).forEach(k => {\n    var multi_detail_post_body = {\n      data: {\n        book_shelf_info: []\n      }\n    }\n    groups_bookids[k].forEach(i => multi_detail_post_body.data.book_shelf_info.push({ book_id: String(i), item_id: '0' }))\n    // var multi_detail_group_url = `https://fanqienovel.com/api/bookshelf/multidetail,${JSON.stringify(multi_detail_post_body)}`\n    // var book_ids = getBookId(JSON.stringify(multi_detail_post_body)).join(\",\")\n    push(k, \"https://fanqienovel.com/fqbookshelf/groupName/\" + k, 0.4)\n  })\n  if (Object.keys(groups_bookids).length % 2 != 0) push(\"占位\", \"\", 0.4)\n  // java.log(JSON.stringify(gro, null, 2))\n  sArr.push(obj(username, '', 1))\n  sArr.push(obj(\"🍅书架🍅\", \"https://fanqienovel.com/fqbookshelf\", 1))\n  sArr = sArr.concat(gro)\n  // java.toast(JSON.stringify(sArr)) \n  sArr.push(obj(\"📔阅读历史📔\", readHistory(), 1))\n  // sArr.push(obj('首页推荐', \"https://fanqienovel.com/tab/0\", 0.4))\n   sArr.push(obj('📚个性推荐📚', \"https://api5-normal-lf.fqnovel.com/reading/bookapi/bookmall/cell/change/v1/?aid=1967&change_type=1&iid=1&app_name=novelapp&version_code=99999&cell_id=7012498777642631182&algo_type=101&category_id=0\", 0.4))\n   sArr.push(obj('🔝巅峰榜单🔝', \"https://fanqienovel.com/api/author/misc/top_book_list/v1/?limit=50&offset=0&version_code=99999\", 0.4))\n   sArr.push(obj('👥男频热搜👥', \"https://novel.snssdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&app_name=news_article&app_version=9.7.3&channel=tengxun_tt&device_platform=android&os=android&device_type=ProjectTitan&os_api=29&os_version=10&openlive_plugin_status=1&isTTWebViewHeifSupport=0&limit=20&offset={{(page-1)*100}}&side_type=12&type=1\", 0.4))\n   sArr.push(obj('👍男频推荐👍', \"https://novel.snssdk.com/api/novel/channel/homepage/rank/rank_list/v2/?aid=13&app_name=news_article&app_version=9.7.3&channel=tengxun_tt&device_platform=android&os=android&device_type=ProjectTitan&os_api=29&os_version=10&openlive_plugin_status=1&isTTWebViewHeifSupport=0&limit=20&offset={{(page-1)*100}}&side_type=10&type=1\", 0.4))\n  \n  \n  \n}\n\narr = sArr.concat(arr)\nJSON.stringify(arr)\n",
    "header": "@js:\nJSON.stringify({\n\t\"x-sec-token\": \"8f79170487338570cdbb178e4653ed25943a6af05f3c29043782de49fc7a8fbd2446589412f746e396a05744cf546027bc63d7391b0e86ff3551c4d8e52ac1f97a2492bcc15dba6a9e2181084ed6e3f2a4d8a7e5aa419a705c5cffc8a93f5827fce376e3c3df14b8498405ba5f2630c0fa948894f4f7e5e26840f431f50396e9\"\n\t})",
    "jsLib": "function splitArray(input, size) {\n  const output = []\n  for (let i = 0; i < input.length; i += size) {\n    output.push(input.slice(i, i + size))\n  }\n  return output\n}\nfunction write_config(key, value) {\n  if (Packages.android.text.TextUtils.isEmpty(this.source.getVariable())) {\n    this.source.setVariable('{}')\n  }\n  // this.java.log('var:' + this.source.getVariable())\n  let obj = JSON.parse(this.source.getVariable())\n  let arr = key.split('.')\n  let temp = obj\n\n  for (let i = 0; i < arr.length - 1; i++) {\n    let currentKey = arr[i]\n    if (!temp[currentKey]) {\n      temp[currentKey] = {}\n    }\n    temp = temp[currentKey]\n  }\n  temp[arr[arr.length - 1]] = value\n  this.source.setVariable(JSON.stringify(obj))\n}\nfunction read_config(key) {\n  if (Packages.android.text.TextUtils.isEmpty(this.source.getVariable())) {\n    this.source.setVariable('{}')\n  }\n  // this.java.log('var:' + this.source.getVariable())\n  let obj = JSON.parse(this.source.getVariable())\n  let arr = key.split('.')\n  let res = JSON.parse(JSON.stringify(obj))\n  for (let i = 0; i < arr.length; i++) {\n    res = res[arr[i]] || (i < (arr.length - 1) ? {} : undefined)\n    // this.java.log(JSON.stringify(res))\n  }\n  return res\n}\nfunction getBookId(url, page) {\n  const {java} = this\n  let $ = JSON.parse(url).data\n  let list\n  let arr\n  if ($.book_shelf_info != 0 && $.book_shelf_info != undefined) {\n   arr = $.book_shelf_info.map($ => $.book_id)\n  } else if (let (list = $.data_list) list != 0 && $.data_list != undefined)  {\n    arr = $.data_list.map($ => $.book_id_str)\n  } else {\n    java.toast(\"获取 book_id 失败，你可能需要登录！\")\n  }\n  return arr.slice(page*100, (page+1)*100)\n}",
    "lastUpdateTime": 1753960329846,
    "loginUi": "[\n{\n        \"name\":  \"🍅番茄账号登录🍅\",\n        \"type\": \"button\",\n        \"action\": \"Y(true)\",\n        \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\": 0.4\n    }\n  },{\n        \"name\":  \"🍅退出登录🍅\",\n        \"type\": \"button\",\n        \"action\": \"X()\",\n        \"style\": {\n      \"layout_flexGrow\": 1,\n      \"layout_flexBasisPercent\": 0.4\n    }\n  }\n]",
    "loginUrl": "function login(){}\nfunction login_(openBrowser, checkMode) {\n    // java.removeCookie(\"snssdk.com\")\n    var cookie_ = String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']\n    // java.toast(cookie_)\n    if (cookie_ && cookie_ != \"\" && !checkMode) {\n        if (!source.variableComment) {\n            java.toast(\"请不要重复登录，请先退出登录！\")\n        } else {\n            java.toast(\"您为填写token登录，请手动移除token后再次登录\")\n        }\n        return false\n    }\n    if (openBrowser) {\n        try {\n            java.startBrowserAwait(\"https://fanqienovel.com/\", \"登录\")\n        } catch (e) {\n            java.toast(e)\n        }\n    }\n    // java.log(\"snssdk cookie: \" + java.getCookie(\"snssdk.com\") + \"will be reomved\")\n    try {\n        cookie.removeCookie(\"snssdk.com\")\n    } catch (e) {}\n    // java.log(cookie)\n    var cookie_ = \"sessionid=\" + String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap())['手动登录Token']\n    let user\n    try {\n      user = JSON.parse(java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({\n        method: \"GET\",\n        headers: {\n          \"Cookie\": cookie_\n        }\n      }))).data.name\n     } catch (e) {java.log(e)}\n    if (!cookie_ || cookie_ == \"sessionid=\" || !user) {\n        java.toast(\"未获取到登录凭据，登录失败\")\n        return false\n    }\n    java.toast(\"欢迎 \" + user + \"\\n登录成功！\")\n    return true\n}\nfunction Y(a, b) {\n  try {\n    login_(a, b)\n  } catch (e) {\n    java.log(e+\"\\n\"+e.stack)\n  }\n}\nfunction X() {\n    cookie.removeCookie(\"fanqienovel.com\");\n    cookie.removeCookie(\"snssdk.com\");\n    if (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) java.toast(\"请手动移除填写的Token\")\n    else java.toast(\"退出登录成功\");\n}",
    "respondTime": 15688,
    "ruleBookInfo": {
      "author": "author",
      "coverUrl": "<js>\nlet replaceCover = (u) => {\n    if (u.startsWith(\"https://\")) u = u.substring(8)\n    else u = u.substring(7)\n    let uArr = u.split(\"/\")\n    uArr[0] = \"https://p6-novel.byteimg.com/origin\"\n    let uArr2 = []\n    uArr.forEach((x) => {\n        if (!x.includes(\"?\") && !x.includes(\"~\")) uArr2.push(x)\n        else uArr2.push(x.split(\"~\")[0])\n    })\n    u = uArr2.join(\"/\")\n    return u\n}\nreplaceCover(java.getString(\"thumb_url\"))\n</js>",
      "init": "data",
      "intro": "&nbsp;&nbsp;\n📖 源名：{{$.original_book_name}}\n📖 别名：{{$.book_flight_alias_name}}\n✏️ 开坑：{{$.create_time##T|\\+.*## }}\n🏷️ 标签：{{$.tags}}\n👤 主角：{{$.roles##\\[|\\\"|\\]}}\n👁️ 在线：{{$.read_count}}人在读{{\"\\n\"+\"​\"}}\n📜 简介：{{$.abstract}}{{\"\\n\"+\"​\"}}\n📍 {{$.copyright_info##，.*##。}}\n@js:result.replace(/.+：(人在读)?\\n/g,\"\")",
      "kind": "{{java.getString(\"gender\")==1?\"男生\":\"女生\"}}\n{{$.category}}\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{java.timeFormat(java.getString(\"last_chapter_update_time\")*1000)}}\n{{$.sub_info}}\n@js:result.replace(\"连载0\",\"\").replace(\"1完结\",\"\").replace(\"连载4完结\",\"断更\")",
      "lastChapter": "{{$.last_chapter_title}} • {{java.timeFormat(java.getString(\"last_chapter_update_time\")*1000)}}",
      "name": "book_name",
      "tocUrl": "/chapter?bookid={{$.book_id}}",
      "wordCount": "word_number"
    },
    "ruleContent": {
      "content": "$.content##妍希"
    },
    "ruleExplore": {
      "author": "$.author",
      "bookList": "<js>\nfunction getBookIdFull(url) {\n\tconst {java} = this\n\t$ = JSON.parse(url).data\n\tif ($.book_shelf_info != 0 && $.book_shelf_info != undefined) {\n\t\tarr = $.book_shelf_info.map($ => $.book_id)\n\t} else if (list = $.data_list != 0 && $.data_list != undefined)  {\n\t\tarr = $.data_list.map($ => $.book_id_str)\n\t} else {\n\t\tjava.toast(\"获取 book_id 失败，你可能需要登录！\")\n\t}\n\treturn arr\n}\nlet ck = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token'])\n\ngetShelf = () => {\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\nlet book_shelf_info = java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': ck\n  }\n}))\n\nlet arrB = []\nfor (let i of JSON.parse(book_shelf_info).data.book_shelf_info) {\n  arrB.push(i.book_id)\n}\nwrite_config('bookshelf.' + read_config('userinfo.userid'), arrB)\n\nbid = getBookIdFull(book_shelf_info)\nlet id_list = splitArray(bid, 100)\nlet urls = []\nid_list.forEach(i => {\n    urls.push(source.key + \"/multi-detail?bookid=\" + i.join(\",\"))\n})\n\nres = java.ajaxAll(urls)\nlet resp = {book_info: []}\nres.forEach(r => {\n  resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n})\n\nreturn resp\n}\n\nfunction getByGroupName(name) {\n  let book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\n\n  let book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n    headers: {\n      'Cookie': ck,\n    }\n  })))\n  let group_bookids = {\n    \"组外\": []\n  }\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!group_bookids[i.group_name ? i.group_name : \"组外\"]) group_bookids[i.group_name] = []\n    group_bookids[i.group_name ? i.group_name : \"组外\"].push(i.book_id)\n  })\n  // java.log(JSON.stringify(group_bookids[\"组外\"]))\n  // java.log(decodeURIComponent(name))\n  if (!group_bookids[decodeURIComponent(name)]) return {data: []}\n  //java.log(\"awa\")\n  let book_ids = splitArray(group_bookids[decodeURIComponent(name)], 100)\n  let urls = []\n\n  book_ids.forEach(i => {\n    urls.push(source.key + \"/multi-detail?bookid=\" + i.join(\",\"))\n  })\n  \n  res = java.ajaxAll(urls)\n\n  let resp = {book_info: []}\n  res.forEach(r => {\n    resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n  })\n\n  return resp\n}\n\nfunction getByTabIndex(index) {\n  let url = _mlsec.requestHeader(\n\t  \"bookmall/tab\",\n    \"version_name=5.8.9.32\",\n\t  null,\n\t  ck\n  )\n  let all = JSON.parse(java.ajax(url))\n  let tab = all.data.tab_item[0].cell_data[index].cell_data\n  if (!tab) tab = []\n  let bookList = []\n  for (let i of tab) {\n    bookList = bookList.concat(i.book_data)\n    // java.log(JSON.stringify(i.book_data))\n  }\n  return { book_info: bookList }\n}\n\nif (baseUrl.endsWith(\"bookshelf\")) result = getShelf(\"bookshelf/info\")\nelse {\n  let w = baseUrl.split(\"/\")\n  if (baseUrl.includes(\"groupName\")) {\n    result = getByGroupName(w[w.length - 1])\n  } else if (baseUrl.includes(\"tab\")) {\n    result = getByTabIndex(parseInt(w[w.length - 1]))\n  } else result = JSON.parse(result)\n}\nJSON.stringify({data: result.book_list || result.book_info || result.data.result || result.data.book_info || result.detail_list || result.data })\n</js>\n$..book_data[*]||$.data[*]",
      "bookUrl": "{{source.key}}detail?bookid={{$.book_id||$.bookId}}",
      "coverUrl": "<js>\nlet replaceCover = (u) => {\n    if (u.startsWith(\"https://\")) u = u.substring(8)\n    else u = u.substring(7)\n    let uArr = u.split(\"/\")\n    uArr[0] = \"https://p6-novel.byteimg.com/origin\"\n    let uArr2 = []\n    uArr.forEach((x) => {\n        if (!x.includes(\"?\") && !x.includes(\"~\")) uArr2.push(x)\n        else uArr2.push(x.split(\"~\")[0])\n    })\n    u = uArr2.join(\"/\")\n    return u\n}\nreplaceCover(java.getString(\"thumb_url\"))\n</js>",
      "intro": "$.abstract##\\n",
      "kind": "男生{{$.gender}}女生\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{$.sub_info||$.category}}\n##连载0|1完结|男生0|1女生|男生女生[\\s\\S]*\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "lastChapter": "{{$.last_chapter_title}} • {{java.timeFormat(java.getString(\"last_chapter_update_time\")*1000)}}",
      "name": "$.book_name",
      "wordCount": "$.word_number"
    },
    "ruleSearch": {
      "author": "author##</?em>",
      "bookList": "$.data.book_data.*||$..book_info[*]||$.[*]",
      "bookUrl": "@js:\nif (baseUrl.match(/detail/)){\n\tresult=baseUrl;\n\t}else {\n\t\tresult=source.key+'detail?bookid={{$.book_id}}'\n\t\t}result",
      "checkKeyWord": "7268620849496722495",
      "coverUrl": "thumb_url",
      "intro": "abstract",
      "kind": "category&&score&&category_tags.[*].category_name",
      "lastChapter": "连载{{$.creation_status}}完结##连载0|1完结",
      "name": "book_name||title##<em>|</em>|《|》"
    },
    "ruleToc": {
      "chapterList": "data.chapterListWithVolume[*].[*]",
      "chapterName": "title",
      "chapterUrl": "/content?item_id={{$.itemId}}",
      "updateTime": "{{$.volume_name}} | {{java.timeFormatUTC(java.getString(\"firstPassTime\") * 1000, 'yyyy-MM-dd HH:mm:ss',28800000)}}\n@js:\nif (result.startsWith(\" |\")) result = result.slice(2)\nif (result.startsWith(\"| \")) result = result.slice(2)\nresult"
    },
    "searchUrl": "@js:\nif (key.match(/\\d{19}/)){\n\tresult=source.key+'detail?bookid='+key\n\t}else {\n\t\tresult=source.key+'search?key='+key+'&page='+page\n\t\t}result",
    "weight": 0
  }
]